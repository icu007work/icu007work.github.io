<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>Kotlin安卓开发-运用手机多媒体 | 米奇妙妙屋</title><meta name="keywords" content="Kotlin,编程入门"><meta name="author" content="Rookie_l"><meta name="copyright" content="Rookie_l"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#18171d"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="Kotlin安卓开发-运用手机多媒体"><meta name="application-name" content="Kotlin安卓开发-运用手机多媒体"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#18171d"><meta property="og:type" content="article"><meta property="og:title" content="Kotlin安卓开发-运用手机多媒体"><meta property="og:url" content="https://icu007work.github.io/archives/3c95749.html"><meta property="og:site_name" content="米奇妙妙屋"><meta property="og:description" content="一、使用通知通知（notification）是Android系统中比较有特色的一个功能，当某个应用程序希望向用户发出一些提示信息，而该应用程序又不在前台运行时，就可以借助通知来实现。发出一条通知后，手机最上方的状态栏中会显示一个通知的图标，下拉状态栏后可以看到通知的详细内容。Android的通知功能"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://pic2.ziyuan.wang/user/xiheya/2024/05/Media_539aad6787976.jpg"><meta property="article:author" content="Rookie_l"><meta property="article:tag" content="二次元 码农 地中海"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://pic2.ziyuan.wang/user/xiheya/2024/05/Media_539aad6787976.jpg"><meta name="description" content="一、使用通知通知（notification）是Android系统中比较有特色的一个功能，当某个应用程序希望向用户发出一些提示信息，而该应用程序又不在前台运行时，就可以借助通知来实现。发出一条通知后，手机最上方的状态栏中会显示一个通知的图标，下拉状态栏后可以看到通知的详细内容。Android的通知功能"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://icu007work.github.io/archives/3c95749"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"Rookie","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 你你你去哪啦??!","backTitle":"♪(^∇^*)你回来啦！"},
  LA51: {"enable":true,"ck":"3FfSkp1Eunbavgru","LingQueMonitorID":"3FfSkp1Eunbavgru"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: {"apiurl":"hexo-circle-of-friends-flax-ten.vercel.app/"},
  navMusic: true,
  mainTone: {"mode":"both","api":"https://img2color-go.vercel.app/api?img=","cover_change":true},
  authorStatus: {"skills":null},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"本文最后更新于","messageNext":"天前，其中的信息可能已经有所发展或是发生改变，请谨慎参考。"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":true,"limitCount":50,"languages":{"author":"作者: Rookie_l","link":"链接: ","source":"来源: 米奇妙妙屋","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#3b70fc","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '米奇妙妙屋',
  title: 'Kotlin安卓开发-运用手机多媒体',
  postAI: '这篇文章是关于Android开发中如何使用通知的教程。通知是Android系统中的一个特色功能，当应用程序希望向用户发出提示信息，而应用程序不在前台运行时，可以使用通知来实现。文章首先介绍了通知的基本概念，然后详细解释了如何在Android 8.0及以上版本中创建通知渠道。通知渠道是Android 8.0引入的一个新概念，每条通知都需要属于一个对应的渠道。应用程序可以创建自己的通知道，但用户有权控制这些通知渠道的重要程度，例如是否响铃、是否振动或者是否关闭这个渠道的通知。文章最后提供了一个示例，展示了如何获取NotificationManager的实例，这是创建通知渠道的第一步。',
  pageFillDescription: '一、使用通知, 1.1 创建通知渠道, 1.2 通知的基本用法, 1.3 通知的进阶技巧, 二、调用摄像头和相册, 2.1 调用摄像头拍照, 2.2 从相册选择图片, 三、播放多媒体文件, 3.1 播放音频, 3.2 播放视频一使用通知通知是系统中比较有特色的一个功能当某个应用程序希望向用户发出一些提示信息而该应用程序又不在前台运行时就可以借助通知来实现发出一条通知后手机最上方的状态栏中会显示一个通知的图标下拉状态栏后可以看到通知的详细内容的通知功能自推出以来就大获成功连系统也在版本之后加入了类似的功能创建通知渠道系统引入了通知渠道这个概念什么是通知渠道呢顾名思义就是每条通知都要属于一个对应的渠道每个应用程序都可以自由地创建当前应用拥有哪些通知渠道但是这些通知渠道的控制权是掌握在用户手上的用户可以自由地选择这些通知渠道的重要程度是否响铃是否振动或者是否要关闭这个渠道的通知拥有了这些控制权之后用户就再也不用害怕那些垃圾通知的打扰了因为用户可以自主地选择关心哪些通知不关心哪些通知而我们的应用程序如果想要发出通知也必须创建自己的通知渠道才行下面我们就来学习一下创建通知渠道的详细步骤首先需要一个对通知进行管理可以通过调用的方法获取方法接收一个字符串参数用于确定获取系统的哪个服务这里我们传入即可因此获取的实例就可以写成接下来要使用类构建一个通知渠道并调用的方法完成创建由于类和方法都是系统中新增的因此我们在使用的时候还需要进行版本判断才可以写法如下创建一个通知渠道至少需要渠道渠道名称以及重要等级这个参数其中渠道可以随便定义只要保证全局唯一性就可以渠道名称是给用户看的需要可以清楚地表达这个渠道的用途通知的重要等级主要有这几种对应的重要程度依次从高到低不同的重要等级会决定通知的不同行为后面我们会通过具体的例子进行演示当然这里只是初始状态下的重要等级用户可以随时手动更改某个通知渠道的重要等级开发者是无法干预的下面来看一下通知的使用方法通知的用法还是比较灵活的既可以在里创建也可以在里创建当然还可以在后面我们即将学习的里创建相比于和在里创建通知的场景还是比较少的因为一般只有当程序进入后台的时候才需要使用通知通知的基本用法不过无论是在哪里创建通知整体的步骤都是相同的下面我们就来看一下创建通知的详细步骤首先需要使用一个构造器来创建对象但问题在于系统的每一个版本都会对通知功能进行或多或少的修改不稳定的问题在通知上凸显得尤其严重比方说刚刚介绍的通知渠道功能在系统之前就是没有的那么该如何解决这个问题呢其实解决方案我们之前已经见过好几回了就是使用库中提供的兼容库中提供了一个类使用这个类的构造器创建对象就可以保证我们的程序在所有系统版本上都能正常工作了代码如下所示的构造函数中接收两个参数第一个参数是这个没什么好说的第二个参数是渠道需要和我们在创建通知渠道时指定的渠道相匹配才行当然上述代码只是创建了一个空的对象并没有什么实际作用我们可以在最终的方法之前连缀任意多的设置方法来创建一个丰富的对象先来看一些最基本的设置上述代码中一共调用了个设置方法下面我们来一一解析一下方法用于指定通知的标题内容下拉系统状态栏就可以看到这部分内容方法用于指定通知的正文内容同样下拉系统状态栏就可以看到这部分内容方法用于设置通知的小图标注意只能使用纯图层的图片进行设置小图标会显示在系统状态栏上方法用于设置通知的大图标当下拉系统状态栏时就可以看到设置的大图标了以上工作都完成之后只需要调用的方法就可以让通知显示出来了方法接收两个参数第一个参数是要保证为每个通知指定的都是不同的第二个参数则是对象这里直接将我们刚刚创建好的对象传入即可因此显示一个通知就可以写成下面就让我们通过一个具体的例子来看看通知到底是长什么样的获取实例判断安卓版本是否为安卓版本为则使用类构建一个通知渠道并调用的方法完成创建检查是否已经有了通知权限如果没有权限向用户显示一个对话框引导他们去设置中开启需要通知权限此应用需要您允许通知权限才能正常工作请点击设置按钮然后在设置中开启通知权限设置取消这个方法需要两个参数一个对象和一个表示哪个按钮被点击的值但是我们不关心这两个参数的具体值所以我们用下划线来代替它们用户点击取消结束应用已经有权限可以进行下一步操作库中提供了一个类使用这个类的构造器创建对象就可以保证我们的程序在所有系统版本上都能正常工作了方法用于指定通知的标题内容下拉系统状态栏就可以看到这部分内容方法用于指定通知的正文内容同样下拉系统状态栏就可以看到这部分内容方法用于设置通知的小图标注意只能使用纯图层的图片进行设置小图标会显示在系统状态栏上方法用于设置通知的大图标当下拉系统状态栏时就可以看到设置的大图标了调用的方法就可以让通知显示出来了方法接收两个参数第一个参数是要保证为每个通知指定的都是不同的第二个参数则是对象这里直接将我们刚刚创建好的对象传入即可如果你使用过手机此时应该会下意识地认为这条通知是可以点击的但是当你去点击它的时候会发现没有任何效果不对啊每条通知被点击之后都应该有所反应呀其实要想实现通知的点击效果我们还需要在代码中进行相应的设置这就涉及了一个新的概念从名字上看起来就和有些类似它们确实存在不少共同点比如它们都可以指明某一个意图都可以用于启动启动以及发送广播等不同的是倾向于立即执行某个动作而倾向于在某个合适的时机执行某个动作所以也可以把简单地理解为延迟执行的的用法同样很简单它主要提供了几个静态方法用于获取的实例可以根据需求来选择是使用方法方法还是方法这几个方法所接收的参数都是相同的第一个参数依旧是不用多做解释第二个参数一般用不到传入即可第三个参数是一个对象我们可以通过这个对象构建出的意图第四个参数用于确定的行为有和这种标志可选这些标志是用来控制行为的下面是每个标志的含义这个标志表示返回的只能使用一次如果后续还需要执行相同的操作你需要再次获取一个新的如果当前的不存在那么简单地返回而不是创建一个新的这个标志表示当前的会被取消然后创建一个新的这意味着旧的不再有效所有的等待的都会被取消如果相同的已经存在那么保持它不变但是替换它的数据这意味着新的数据会被用来更新已经存在的从级别开始创建时必须指定或这是因为对的行为进行了更改以提高应用的安全性这个标志表示是不可变的也就是说一旦创建就不能更改这是推荐的选项因为它可以防止潜在的安全问题这个标志表示是可变的也就是说可以在创建后进行更改只有在某些功能依赖于的可变性时才应该使用这个选项例如需要与内联回复或气泡一起使用对有了一定的了解后我们再回过头来看一下这个构造器还可以连缀一个方法接收的参数正是一个对象因此这里就可以通过构建一个延迟执行的意图当用户点击这条通知时就会执行相应的逻辑现在我们来优化一下项目给刚才的通知加上点击功能让用户点击它的时候可以启动另一个这个标志表示是不可变的也就是说一旦创建就不能更改这是推荐的选项因为它可以防止潜在的安全问题这个标志表示是可变的也就是说可以在创建后进行更改只有在某些功能依赖于的可变性时才应该使用这个选项例如需要与内联回复或气泡一起使用获取实例判断安卓版本是否为安卓版本为则使用类构建一个通知渠道并调用的方法完成创建检查是否已经有了通知权限如果没有权限向用户显示一个对话框引导他们去设置中开启需要通知权限此应用需要您允许通知权限才能正常工作请点击设置按钮然后在设置中开启通知权限设置取消这个方法需要两个参数一个对象和一个表示哪个按钮被点击的值但是我们不关心这两个参数的具体值所以我们用下划线来代替它们用户点击取消结束应用从级别开始创建时必须指定或这是因为对的行为进行了更改以提高应用的安全性这个标志表示是不可变的也就是说一旦创建就不能更改这是推荐的选项因为它可以防止潜在的安全问题这个标志表示是可变的也就是说可以在创建后进行更改只有在某些功能依赖于的可变性时才应该使用这个选项例如需要与内联回复或气泡一起使用已经有权限可以进行下一步操作库中提供了一个类使用这个类的构造器创建对象就可以保证我们的程序在所有系统版本上都能正常工作了方法用于指定通知的标题内容下拉系统状态栏就可以看到这部分内容方法用于指定通知的正文内容同样下拉系统状态栏就可以看到这部分内容方法用于设置通知的小图标注意只能使用纯图层的图片进行设置小图标会显示在系统状态栏上方法用于设置通知的大图标当下拉系统状态栏时就可以看到设置的大图标了调用的方法就可以让通知显示出来了方法接收两个参数第一个参数是要保证为每个通知指定的都是不同的第二个参数则是对象这里直接将我们刚刚创建好的对象传入即可如果我们没有在代码中对该通知进行取消它就会一直显示在系统的状态栏上解决的方法有两种一种是在中再连缀一个方法一种是显式地调用的方法将它取消两种方法我们都学习一下第一种方法写法如下方法传入就表示当点击这个通知的时候通知会自动取消第二种方法写法如下这里我们在方法中传入了当时我们给这条通知设置的就是因此如果你想取消哪条通知在方法中传入该通知的就行了通知的进阶技巧当我们想在通知中显示较长的富文本时会发现会将通知中的长文本折叠起来那么有没有什么办法把富文本全部显示出来呢实际上中提供了非常丰富的以便我们创建出更加多样的通知效果先来看看方法这个方法允许我们构建出富文本的通知内容也就是说通知中不光可以有文字和图标还可以包含更多的东西方法接收一个参数这个参数就是用来构建具体的富文本信息的如长文字图片等这里使用了方法替代方法在方法中我们创建了一个对象这个对象就是用于封装长文字信息的只要调用它的方法并将文字内容传入就可以了除了显示长文字之外通知里还可以显示一张大图片具体用法是基本相似的可以看到这里仍然是调用的方法这次我们在参数中创建了一个对象这个对象就是用于设置大图片的然后调用它的方法并将图片传入这里使用事先准备好的一张图片通过的方法将图片解析成对象再传入方法中就可以了接下来来学习一下不同重要等级的通知渠道对通知的行为具体有什么影响其实简单来讲就是通知渠道的重要等级越高发出的通知就越容易获得用户的注意比如高重要等级的通知渠道发出的通知可以弹出横幅发出声音而低重要等级的通知渠道发出的通知不仅可能会在某些情况下被隐藏而且可能会被改变显示的顺序将其排在更重要的通知之后但需要注意的是开发者只能在创建通知渠道的时候为它指定初始的重要等级如果用户不认可这个重要等级的话可以随时进行修改开发者对此无权再进行调整和变更因为通知渠道一旦创建就不能再通过代码修改了虽然无法更改之前创建的通知渠道但是我们可以创建一个新的通知渠道如下二调用摄像头和相册我们平时在使用或微信的时候经常要和别人分享图片这些图片可以是用手机摄像头拍的也可以是从相册中选取的这样的功能实在是太常见了几乎是应用程序必备的功能那么本节我们就学习一下调用摄像头和相册方面的知识调用摄像头拍照首先在布局文件中添加两个控件一个和一个是用于打开摄像头进行拍照的而则是用于将拍到的图片显示出来开始编写调用摄像头的具体逻辑修改中的代码如下所示在这里处理图片捕获成功的情况在这里处理图片捕获失败的情况已经被弃用将不再需要的对象回收在中要做的第一件事自然是给注册点击事件然后就是实例化对象并且注册返回结果的处理函数紧接着在点击事件里开始处理调用摄像头的逻辑首先这里创建了一个对象用于存放摄像头拍下的图片这里我们把图片命名为并存放在手机卡的应用关联缓存目录下什么叫作应用关联缓存目录呢就是指卡中专门用于存放当前应用缓存数据的位置调用方法可以得到这个目录具体的路径是那么为什么要使用应用关联缓存目录来存放图片呢因为从系统开始读写卡被列为了危险权限如果将图片存放在卡的任何其他目录都要进行运行时权限处理才行而使用应用关联目录则可以跳过这一步另外从系统开始公有的卡目录已经不再允许被应用程序直接访问了而是要使用作用域存储才行接着会进行一个判断如果运行设备的系统版本低于就调用的方法将对象转换成对象这个对象标识着这张图片的本地真实路径否则就调用的方法将对象转换成一个封装过的对象方法接收个参数第一个参数要求传入对象第二个参数可以是任意唯一的字符串第三个参数则是我们刚刚创建的对象之所以要进行这样一层转换是因为从系统开始直接使用本地真实路径的被认为是不安全的会抛出一个异常而则是一种特殊的它使用了和类似的机制来对数据进行保护可以选择性地将封装过的共享给外部从而提高了应用的安全性接下来构建了一个对象并将这个的指定为再调用的方法指定图片的输出地址这里填入刚刚得到的对象最后调用对象的方法来启动相机应用进行捕获图片调用照相机程序去拍照有可能会在一些手机上发生照片旋转的情况这是因为这些手机认为打开摄像头进行拍摄时手机就应该是横屏的因此回到竖屏的情况下就会发生度的旋转为此这里我们又加上了判断图片方向的代码如果发现图片需要进行旋转那么就先将图片旋转相应的角度然后再显示到界面上刚才提到了那么我们自然要在中对它进行注册才行代码如下所示属性的值是固定的而属性的值必须和刚才方法中的第二个参数一致另外这里还在标签的内部使用指定的共享路径并引用了一个资源当然这个资源现在还是不存在的下面我们就来创建它右击目录创建一个目录接着右击目录创建一个文件然后修改文件中的内容如下所示就是用来指定共享路径的属性的值可以随便填属性的值表示共享的具体路径这里使用一个单斜线表示将整个卡进行共享当然你也可以仅共享存放这张图片的路径从相册选择图片还是在项目基础上修改新增一个用于从相册中选择图片修改代码在按钮的点击事件里我们先构建了一个对象并将它的指定为表示打开系统的文件选择器接着给这个对象设置一些条件过滤只允许可打开的图片文件显示出来然后调用打开文件选择器在这段代码中使用方法注册了一个回调函数这个方法接收两个参数一个是要启动的的类型描述另一个是回调函数此处的表示启动的是为了返回数据在回调函数中参数即代表启动的结果在回调函数中首先检查了这也是常见的模式意味着返回的结果有效且有返回数据在此条件满足的情况下这段代码解释了对返回的数据即图片的的处理使用是语言中的函数式编程风格当不为空时执行其代码块此处的即代表图片的这段代码使用解码得到一个而是使用从图片的中获取到的将解码得到的设为的图像显示三播放多媒体文件手机上最常见的休闲方式毫无疑问就是听音乐和看电影了随着移动设备的普及越来越多的人可以随时享受优美的音乐观看精彩的电影在播放音频和视频方面做了相当不错的支持它提供了一套较为完整的使得开发者可以很轻松地编写出一个简易的音频或视频播放器下面我们就来具体地学习一下播放音频在中播放音频文件一般是使用类实现的它对多种格式的音频文件提供了非常全面的控制方法从而使播放音乐的工作变得十分简单下表列出了类中一些较为常用的控制方法方法名功能描述设置要播放的音频文件的位置在开始播放之前调用以完成准备工作开始或继续播放音频暂停播放音频将对象重置到刚刚创建的状态从指定的位置开始播放音频停止播放音频调用后的对象无法再播放音频释放与对象相关的资源判断当前是否正在播放音频获取载入的音频文件的时长简单了解了上述方法后我们再来梳理一下的工作流程首先需要创建一个对象然后调用方法设置音频文件的路径再调用方法使进入准备状态接下来调用方法就可以开始播放音频调用方法就会暂停播放调用方法就会停止播放下面就让我们通过一个具体的例子来学习一下代码如下所示人生浪费指南夏日入侵企画在类初始化的时候我们就先创建了一个的实例然后在方法中调用方法为对象进行初始化操作在方法中首先通过方法得到了一个的实例可用于读取目录下的任何资源接着我们调用了方法将音频文件句柄打开后面又依次调用了方法和方法为做好了播放前的准备当点击按钮时会进行判断如果当前没有正在播放音频则调用方法开始播放当点击按钮时会判断如果当前正在播放音频则调用方法暂停播放当点击按钮时会判断如果当前正在播放音频则调用方法将重置为刚刚创建的状态然后重新调用一遍方法最后在方法中我们还需要分别调用方法和方法将与相关的资源释放掉播放视频播放视频文件其实并不比播放音频文件复杂主要是使用类来实现的这个类将视频的显示和控制集于一身我们仅仅借助它就可以完成一个简易的视频播放器的用法和也比较类似常用方法如下表所示方法名功能描述设置要播放的视频文件的位置开始或继续播放视频暂停播放视频将视频从头开始播放从指定的位置开始播放视频判断当前是否正在播放视频获取载入的视频文件的时长释放所占用的资源编辑布局文件如下而后修改中的代码如下首先在方法中调用了方法将目录下的文件解析成了一个对象这里使用的写法是要求的固定写法然后调用的方法将刚才解析出来的对象传入这样就初始化完成了当点击按钮时会判断如果当前没有正在播放视频则调用方法开始播放当点击按钮时会判断如果当前视频正在播放则调用方法暂停播放当点击按钮时会判断如果当前视频正在播放则调用方法从头播放视频最后在方法中我们还需要调用一下方法将所占用的资源释放掉还添加了一个可以提供一套控制面板用户可以用它来播放暂停和快进视频',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-05-11 15:48:32',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/mycss/charlie.css"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="米奇妙妙屋" type="application/atom+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://icu007.work/wp-content/uploads/2022/03/head-1.jpeg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://icu007.work/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.png" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://chat.icu007.work/" title="ChatGPT"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.png" alt="ChatGPT"/><span class="back-menu-item-text">ChatGPT</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://baidu.icu007.work/" title="帮你百度一下"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.png" alt="帮你百度一下"/><span class="back-menu-item-text">帮你百度一下</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">米奇妙妙屋</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 站务</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 空调</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友链</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?id=6842714056&amp;server=netease"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 番剧</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于我</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 碎碎念</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 传送门</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" alt="wechat" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/wechat.jpg"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" alt="alipay" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/alipay.jpg"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Android/" style="font-size: 1.05rem;">Android<sup>2</sup></a><a href="/tags/Dos/" style="font-size: 1.05rem;">Dos<sup>1</sup></a><a href="/tags/IDEA/" style="font-size: 1.05rem;">IDEA<sup>1</sup></a><a href="/tags/Java/" style="font-size: 1.05rem;">Java<sup>23</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/" style="font-size: 1.05rem;">Java基础语法<sup>5</sup></a><a href="/tags/Java%E5%BC%82%E5%B8%B8/" style="font-size: 1.05rem;">Java异常<sup>2</sup></a><a href="/tags/Java%E6%95%B0%E7%BB%84/" style="font-size: 1.05rem;">Java数组<sup>3</sup></a><a href="/tags/Java%E6%96%B9%E6%B3%95/" style="font-size: 1.05rem;">Java方法<sup>1</sup></a><a href="/tags/Java%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/" style="font-size: 1.05rem;">Java流程控制<sup>3</sup></a><a href="/tags/Java%E7%89%B9%E6%80%A7/" style="font-size: 1.05rem;">Java特性<sup>1</sup></a><a href="/tags/Java%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" style="font-size: 1.05rem;">Java面向对象<sup>4</sup></a><a href="/tags/Kotlin/" style="font-size: 1.05rem;">Kotlin<sup>13</sup></a><a href="/tags/Markdown/" style="font-size: 1.05rem;">Markdown<sup>1</sup></a><a href="/tags/WP/" style="font-size: 1.05rem;">WP<sup>1</sup></a><a href="/tags/git/" style="font-size: 1.05rem;">git<sup>2</sup></a><a href="/tags/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" style="font-size: 1.05rem;">排序算法<sup>1</sup></a><a href="/tags/%E7%A1%AC%E4%BB%B6/" style="font-size: 1.05rem;">硬件<sup>1</sup></a><a href="/tags/%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8/" style="font-size: 1.05rem;">编程入门<sup>13</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 1.05rem;">设计模式<sup>2</sup></a><a href="/tags/%E8%BD%AF%E4%BB%B6%E5%88%86%E4%BA%AB/" style="font-size: 1.05rem;">软件分享<sup>1</sup></a><a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 1.05rem;">随笔<sup>13</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/02/"><span class="card-archive-list-date">二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/12/"><span class="card-archive-list-date">十二月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">十一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">十月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/09/"><span class="card-archive-list-date">九月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url">技术</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Kotlin/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Kotlin</span></a><a class="article-meta__tags" href="/tags/%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>编程入门</span></a></span></div></div><h1 class="post-title" itemprop="name headline">Kotlin安卓开发-运用手机多媒体</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-12-26T07:18:10.000Z" title="发表于 2023-12-26 15:18:10">2023-12-26</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-05-11T07:48:32.464Z" title="更新于 2024-05-11 15:48:32">2024-05-11</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">9.3k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>35分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="Kotlin安卓开发-运用手机多媒体"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为深圳"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>深圳</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://pic2.ziyuan.wang/user/xiheya/2024/05/Media_539aad6787976.jpg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><div class="post-ai-description"><div class="ai-title"><i class="anzhiyufont anzhiyu-icon-bilibili"></i><div class="ai-title-text">AI-摘要</div><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i><i class="anzhiyufont anzhiyu-icon-circle-dot" title="朗读摘要"></i><div id="ai-tag">Rookie GPT</div></div><div class="ai-explanation">AI初始化中...</div><div class="ai-btn-box"><div class="ai-btn-item">介绍自己 🙈</div><div class="ai-btn-item">生成本文简介 👋</div><div class="ai-btn-item">推荐相关文章 📖</div><div class="ai-btn-item">前往主页 🏠</div><div class="ai-btn-item" id="go-tianli-blog">前往爱发电购买</div></div><script data-pjax src="/js/anzhiyu/ai_abstract.js"></script></div><article class="post-content" id="article-container" itemscope itemtype="https://icu007work.github.io/archives/3c95749.html"><header><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url">技术</a><a href="/tags/Kotlin/" tabindex="-1" itemprop="url">Kotlin</a><a href="/tags/%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8/" tabindex="-1" itemprop="url">编程入门</a><h1 id="CrawlerTitle" itemprop="name headline">Kotlin安卓开发-运用手机多媒体</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Rookie_l</span><time itemprop="dateCreated datePublished" datetime="2023-12-26T07:18:10.000Z" title="发表于 2023-12-26 15:18:10">2023-12-26</time><time itemprop="dateCreated datePublished" datetime="2024-05-11T07:48:32.464Z" title="更新于 2024-05-11 15:48:32">2024-05-11</time></header><h2 id="一、使用通知"><a href="#一、使用通知" class="headerlink" title="一、使用通知"></a>一、使用通知</h2><p>通知（notification）是Android系统中比较有特色的一个功能，当某个应用程序希望向用户发出一些提示信息，而该应用程序又不在前台运行时，就可以借助通知来实现。发出一条通知后，手机最上方的状态栏中会显示一个通知的图标，下拉状态栏后可以看到通知的详细内容。Android的通知功能自推出以来就大获成功，连iOS系统也在5.0版本之后加入了类似的功能。</p>
<h3 id="1-1-创建通知渠道"><a href="#1-1-创建通知渠道" class="headerlink" title="1.1 创建通知渠道"></a>1.1 创建通知渠道</h3><p>Android 8.0系统引入了通知渠道这个概念。什么是通知渠道呢？顾名思义，就是每条通知都要属于一个对应的渠道。每个应用程序都可以自由地创建当前应用拥有哪些通知渠道，但是这些通知渠道的控制权是掌握在用户手上的。用户可以自由地选择这些通知渠道的重要程度，是否响铃、是否振动或者是否要关闭这个渠道的通知。</p>
<p>拥有了这些控制权之后，用户就再也不用害怕那些垃圾通知的打扰了，因为用户可以自主地选择关心哪些通知、不关心哪些通知。</p>
<p>而我们的应用程序如果想要发出通知，也必须创建自己的通知渠道才行，下面我们就来学习一下创建通知渠道的详细步骤。</p>
<p>首先需要一个<code>NotificationManager</code>对通知进行管理，可以通过调用Context的<code>getSystemService()</code>方法获取。<code>getSystemService()</code>方法接收一个字符串参数用于确定获取系统的哪个服务，这里我们传入<code>Context.NOTIFICATION_SERVICE</code>即可。因此，获取<code>NotificationManager</code>的实例就可以写成：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> manager = getSystemService(Context.NOTIFICATION_SERVICE) <span class="keyword">as</span> NotificationManager</span><br></pre></td></tr></table></figure>

<p>接下来要使用<code>NotificationChannel</code>类构建一个通知渠道，并调用<code>NotificationManager</code>的<code>createNotificationChannel()</code>方法完成创建。由于<code>NotificationChannel</code>类和<code>createNotificationChannel()</code>方法都是Android 8.0系统中新增的API，因此我们在使用的时候还需要进行版本判断才可以，写法如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODE.O) &#123;</span><br><span class="line">    <span class="keyword">val</span> channel = NotificationChannel(channelId, channelName, importance)</span><br><span class="line">    manager.createNotificationChannel(channel)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建一个通知渠道至少需要<strong>渠道ID</strong>、<strong>渠道名称</strong>以及<strong>重要等级</strong>这<strong>3个参数</strong>，其中<strong>渠道ID可以随便定义，只要保证全局唯一性就可以</strong>。<strong>渠道名称是给用户看的，需要可以清楚地表达这个渠道的用途</strong>。<strong>通知的重要等级主要有IMPORTANCE_HIGH、IMPORTANCE_DEFAULT、IMPORTANCE_LOW、IMPORTANCE_MIN这几种，对应的重要程度依次从高到低</strong>。不同的重要等级会决定通知的不同行为，后面我们会通过具体的例子进行演示。当然这里只是初始状态下的重要等级，用户可以随时手动更改某个通知渠道的重要等级，开发者是无法干预的。</p>
<p>下面来看一下通知的使用方法。通知的用法还是比较灵活的，既可以在<code>Activity</code>里创建，也可以在<code>BroadcastReceiver</code>里创建，当然还可以在后面我们即将学习的<code>Service</code>里创建。相比于<code>BroadcastReceiver</code>和<code>Service</code>，在<code>Activity</code>里创建通知的场景还是比较少的，因为一般只有当程序进入后台的时候才需要使用通知。</p>
<h3 id="1-2-通知的基本用法"><a href="#1-2-通知的基本用法" class="headerlink" title="1.2 通知的基本用法"></a>1.2 通知的基本用法</h3><p>不过，无论是在哪里创建通知，整体的步骤都是相同的，下面我们就来看一下创建通知的详细步骤。</p>
<p>首先需要使用一个<code>Builder</code>构造器来创建<code>Notification</code>对象，但问题在于，Android系统的每一个版本都会对通知功能进行或多或少的修改，API不稳定的问题在通知上凸显得尤其严重，比方说刚刚介绍的通知渠道功能在Android 8.0系统之前就是没有的。那么该如何解决这个问题呢？其实解决方案我们之前已经见过好几回了，<strong>就是使用<code>AndroidX</code>库中提供的兼容API。<code>AndroidX</code>库中提供了一个<code>NotificationCompat</code>类，使用这个类的构造器创建<code>Notification</code>对象，就可以保证我们的程序在所有Android系统版本上都能正常工作了，代码如下所示</strong>：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> notification = NotificationCompat.Builder(context, channelId).build()</span><br></pre></td></tr></table></figure>

<p><code>NotificationCompat.Builder</code>的构造函数中接收两个参数：<strong>第一个参数是context</strong>，这个没什么好说的；<strong>第二个参数是渠道ID</strong>，需要和我们在创建通知渠道时指定的渠道ID相匹配才行。</p>
<p>当然，上述代码只是创建了一个空的Notification对象，并没有什么实际作用，我们可以在最终的<code>build()</code>方法之前连缀任意多的设置方法来创建一个丰富的Notification对象，先来看一些最基本的设置：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> notification = NotificationCompat.Builder(context, channelId)</span><br><span class="line">.setContentTitle(<span class="string">&quot;this is content title&quot;</span>).setContentText(<span class="string">&quot;This is content text&quot;</span>)</span><br><span class="line">.setSmallIcon(R.drawable.small_icon)</span><br><span class="line">.setLargeIcon(BitmapFactory.decodeResource(getResources(),R.drawable.large_icon))</span><br><span class="line">.build()</span><br></pre></td></tr></table></figure>

<p>上述代码中一共调用了4个设置方法，下面我们来一一解析一下。<code>setContentTitle()</code>方法用于指定通知的标题内容，下拉系统状态栏就可以看到这部分内容。<code>setContentText()</code>方法用于指定通知的正文内容，同样下拉系统状态栏就可以看到这部分内容。<code>setSmallIcon()</code>方法用于设置通知的小图标，注意，只能使用纯alpha图层的图片进行设置，小图标会显示在系统状态栏上。<code>setLargeIcon()</code>方法用于设置通知的大图标，当下拉系统状态栏时，就可以看到设置的大图标了。</p>
<p>以上工作都完成之后，只需要调用<code>NotificationManager</code>的<code>notify()</code>方法就可以让通知显示出来了。<code>notify()</code>方法接收两个参数：<strong>第一个参数是id</strong>，要保证为每个通知指定的id都是不同的；<strong>第二个参数则是<code>Notification</code>对象</strong>，这里直接将我们刚刚创建好的Notification对象传入即可。因此，显示一个通知就可以写成：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">manager.notify(<span class="number">1</span>,notification)</span><br></pre></td></tr></table></figure>

<p>下面就让我们通过一个具体的例子来看看通知到底是长什么样的。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ubx.notificationtest</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.NotificationChannel</span><br><span class="line"><span class="keyword">import</span> android.app.NotificationManager</span><br><span class="line"><span class="keyword">import</span> android.content.Context</span><br><span class="line"><span class="keyword">import</span> android.content.Intent</span><br><span class="line"><span class="keyword">import</span> android.graphics.BitmapFactory</span><br><span class="line"><span class="keyword">import</span> android.net.Uri</span><br><span class="line"><span class="keyword">import</span> android.os.Build</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle</span><br><span class="line"><span class="keyword">import</span> android.provider.Settings</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AlertDialog</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity</span><br><span class="line"><span class="keyword">import</span> androidx.core.app.NotificationCompat</span><br><span class="line"><span class="keyword">import</span> androidx.core.app.NotificationManagerCompat</span><br><span class="line"><span class="keyword">import</span> com.ubx.notificationtest.databinding.ActivityMainBinding</span><br><span class="line"><span class="keyword">import</span> kotlin.random.Random</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> mainBinding: ActivityMainBinding</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        mainBinding = ActivityMainBinding.inflate(layoutInflater)</span><br><span class="line">        setContentView(mainBinding.root)</span><br><span class="line">        <span class="comment">// 获取NotificationManager实例</span></span><br><span class="line">        <span class="keyword">val</span> manager = getSystemService(Context.NOTIFICATION_SERVICE) <span class="keyword">as</span> NotificationManager</span><br><span class="line">        <span class="comment">// 判断安卓版本是否为Android 8.0+</span></span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;</span><br><span class="line">            <span class="comment">// 安卓版本为 8.0+ 则使用NotificationChannel类构建一个通知渠道，</span></span><br><span class="line">            <span class="comment">// 并调用NotificationManager的createNotificationChannel()方法完成创建</span></span><br><span class="line">            <span class="keyword">val</span> channel =</span><br><span class="line">                NotificationChannel(<span class="string">&quot;normal&quot;</span>, <span class="string">&quot;Normal&quot;</span>, NotificationManager.IMPORTANCE_DEFAULT)</span><br><span class="line">            manager.createNotificationChannel(channel)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mainBinding.sendNotice.setOnClickListener &#123;</span><br><span class="line">            <span class="comment">// 检查是否已经有了通知权限</span></span><br><span class="line">            <span class="keyword">if</span> (!NotificationManagerCompat.from(<span class="keyword">this</span>).areNotificationsEnabled()) &#123;</span><br><span class="line">                <span class="comment">// 如果没有权限，向用户显示一个对话框，引导他们去设置中开启</span></span><br><span class="line">                AlertDialog.Builder(<span class="keyword">this</span>)</span><br><span class="line">                    .setTitle(<span class="string">&quot;需要通知权限&quot;</span>)</span><br><span class="line">                    .setMessage(<span class="string">&quot;此应用需要您允许通知权限才能正常工作。请点击“设置”按钮，然后在设置中开启通知权限。&quot;</span>)</span><br><span class="line">                    .setPositiveButton(<span class="string">&quot;设置&quot;</span>) &#123; _, _ -&gt;</span><br><span class="line">                        <span class="keyword">val</span> intent = Intent(Settings.ACTION_APPLICATION_DETAILS_SETTINGS)</span><br><span class="line">                        <span class="keyword">val</span> uri = Uri.fromParts(<span class="string">&quot;package&quot;</span>, packageName, <span class="literal">null</span>)</span><br><span class="line">                        intent.<span class="keyword">data</span> = uri</span><br><span class="line">                        startActivity(intent)</span><br><span class="line">                    &#125;</span><br><span class="line">                    .setNegativeButton(<span class="string">&quot;取消&quot;</span>) &#123; _, _ -&gt;</span><br><span class="line">                        <span class="comment">/*这个方法需要两个参数（一个 DialogInterface 对象和一个表示哪个按钮被点击的 int 值），</span></span><br><span class="line"><span class="comment">                        但是我们不关心这两个参数的具体值，所以我们用下划线 _ 来代替它们*/</span></span><br><span class="line">                        <span class="comment">// 用户点击取消，结束应用</span></span><br><span class="line">                        finish()</span><br><span class="line">                    &#125;</span><br><span class="line">                    .show()</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 已经有权限，可以进行下一步操作</span></span><br><span class="line">                <span class="comment">// AndroidX库中提供了一个NotificationCompat类，使用这个类的构造器创建</span></span><br><span class="line">                <span class="comment">// Notification对象，就可以保证我们的程序在所有Android系统版本上都能正常工作了</span></span><br><span class="line">                <span class="keyword">val</span> notification = NotificationCompat.Builder(<span class="keyword">this</span>, <span class="string">&quot;normal&quot;</span>)</span><br><span class="line">                    <span class="comment">// setContentTitle()方法用于指定通知的标题内容，下拉系统状态栏就可以看到这部分内容。</span></span><br><span class="line">                    .setContentTitle(<span class="string">&quot;this is content title&quot;</span>)</span><br><span class="line">                    <span class="comment">// setContentText()方法用于指定通知的正文内容，同样下拉系统状态栏就可以看到这部分内容。</span></span><br><span class="line">                    .setContentText(<span class="string">&quot;this is content text&quot;</span>.repeat(Random.nextInt(<span class="number">5</span>, <span class="number">10</span>)))</span><br><span class="line">                    <span class="comment">// setSmallIcon()方法</span></span><br><span class="line">                    <span class="comment">//用于设置通知的小图标，注意，只能使用纯alpha图层的图片进行设置，小图标会显示在系统状态栏上</span></span><br><span class="line">                    .setSmallIcon(R.drawable.small_icon)</span><br><span class="line">                    <span class="comment">// setLargeIcon()方法用于设置通知的大图标，当下拉系统状态栏时，就可以看到设置的大图标了。</span></span><br><span class="line">                    .setLargeIcon(</span><br><span class="line">                        BitmapFactory.decodeResource(</span><br><span class="line">                            resources,</span><br><span class="line">                            R.drawable.large_icon</span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                    .build()</span><br><span class="line">                <span class="comment">// 调用NotificationManager的notify()方法就可以让通知显示出来了。notify()方法接收两个参数：</span></span><br><span class="line">                <span class="comment">// 第一个参数是id，要保证为每个通知指定的id都是不同的；第二个参数则是Notification对象，</span></span><br><span class="line">                <span class="comment">// 这里直接将我们刚刚创建好的Notification对象传入即可。</span></span><br><span class="line">                manager.notify(<span class="number">1</span>, notification)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> TAG = <span class="string">&quot;MainActivity&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果你使用过Android手机，此时应该会下意识地认为这条通知是可以点击的。但是当你去点击它的时候，会发现没有任何效果。不对啊，每条通知被点击之后都应该有所反应呀。其实要想实现通知的点击效果，我们还需要在代码中进行相应的设置，这就涉及了一个新的概念——<code>PendingIntent</code>。</p>
<p><code>PendingIntent</code>从名字上看起来就和Intent有些类似，它们确实存在不少共同点。比如它们都可以指明某一个“意图”，都可以用于启动Activity、启动Service以及发送广播等。不同的是，<code>Intent</code>倾向于立即执行某个动作，而<code>PendingIntent</code>倾向于在某个合适的时机执行某个动作。所以，也可以把<code>PendingIntent</code>简单地理解为**延迟执行的<code>Intent</code>**。</p>
<p><code>PendingIntent</code>的用法同样很简单，它主要提供了几个静态方法用于获取<code>PendingIntent</code>的实例，可以根据需求来选择是使用<code>getActivity()</code>方法、<code>getBroadcast()</code>方法，还是<code>getService()</code>方法。这几个方法所接收的参数都是相同的：第一个参数依旧是<code>Context</code>，不用多做解释；第二个参数一般用不到，传入0即可；第三个参数是一个<code>Intent</code>对象，我们可以通过这个对象构建出<code>PendingIntent</code>的“意图”；第四个参数用于确定<code>PendingIntent</code>的行为，有<code>FLAG_ONE_SHOT</code>、<code>FLAG_NO_CREATE</code>、<code>FLAG_CANCEL_CURRENT</code>和<code>FLAG_UPDATE_CURRENT</code>这4种标志可选.这些标志是用来控制 <code>PendingIntent</code> 行为的。下面是每个标志的含义：</p>
<ol>
<li><code>FLAG_ONE_SHOT</code>：这个标志表示返回的 <code>PendingIntent</code> 只能使用一次。如果后续还需要执行相同的操作，你需要再次获取一个新的 <code>PendingIntent</code>。</li>
<li><code>FLAG_NO_CREATE</code>：如果当前的 <code>PendingIntent</code> 不存在，那么简单地返回 <code>null</code>，而不是创建一个新的 <code>PendingIntent</code>。</li>
<li><code>FLAG_CANCEL_CURRENT</code>：这个标志表示当前的 <code>PendingIntent</code> 会被取消，然后创建一个新的 <code>PendingIntent</code>。这意味着旧的 <code>PendingIntent</code> 不再有效，所有的等待的 <code>Intent</code> 都会被取消。</li>
<li><code>FLAG_UPDATE_CURRENT</code>：如果相同的 <code>PendingIntent</code> 已经存在，那么保持它不变，但是替换它的 <code>Intent</code> 数据。这意味着新的 <code>Intent</code> 数据会被用来更新已经存在的 <code>PendingIntent</code>。</li>
</ol>
<p>从 Android 12（API 级别 31）开始，创建 <code>PendingIntent</code> 时必须指定 <code>FLAG_IMMUTABLE</code> 或 <code>FLAG_MUTABLE</code>。这是因为 Android 12 对 <code>PendingIntent</code> 的行为进行了更改，以提高应用的安全性。</p>
<ul>
<li><p><code>FLAG_IMMUTABLE</code>：这个标志表示 <code>PendingIntent</code> 是不可变的，也就是说，一旦创建，就不能更改。这是推荐的选项，因为它可以防止潜在的安全问题。</p>
</li>
<li><p><code>FLAG_MUTABLE</code>：这个标志表示 <code>PendingIntent</code> 是可变的，也就是说，可以在创建后进行更改。只有在某些功能依赖于 <code>PendingIntent</code> 的可变性时，才应该使用这个选项，例如，需要与内联回复或气泡一起使用。</p>
</li>
</ul>
<p>对<code>PendingIntent</code>有了一定的了解后，我们再回过头来看一下<code>NotificationCompat.Builder</code>。这个构造器还可以连缀一个<code>setContentIntent()</code>方法，接收的参数正是一个<code>PendingIntent</code>对象。因此，这里就可以通过<code>PendingIntent</code>构建一个延迟执行的“意图”，当用户点击这条通知时就会执行相应的逻辑。</p>
<p>现在我们来优化一下<code>NotificationTest</code>项目，给刚才的通知加上点击功能，让用户点击它的时候可以启动另一个Activity。</p>
<ul>
<li><code>FLAG_IMMUTABLE</code>：这个标志表示 <code>PendingIntent</code> 是不可变的，也就是说，一旦创建，就不能更改。这是推荐的选项，因为它可以防止潜在的安全问题。</li>
<li><code>FLAG_MUTABLE</code>：这个标志表示 <code>PendingIntent</code> 是可变的，也就是说，可以在创建后进行更改。只有在某些功能依赖于 <code>PendingIntent</code> 的可变性时，才应该使用这个选项，例如，需要与内联回复或气泡一起使用。</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ubx.notificationtest</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.NotificationChannel</span><br><span class="line"><span class="keyword">import</span> android.app.NotificationManager</span><br><span class="line"><span class="keyword">import</span> android.app.PendingIntent</span><br><span class="line"><span class="keyword">import</span> android.content.Context</span><br><span class="line"><span class="keyword">import</span> android.content.Intent</span><br><span class="line"><span class="keyword">import</span> android.graphics.BitmapFactory</span><br><span class="line"><span class="keyword">import</span> android.net.Uri</span><br><span class="line"><span class="keyword">import</span> android.os.Build</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle</span><br><span class="line"><span class="keyword">import</span> android.provider.Settings</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AlertDialog</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity</span><br><span class="line"><span class="keyword">import</span> androidx.core.app.NotificationCompat</span><br><span class="line"><span class="keyword">import</span> androidx.core.app.NotificationManagerCompat</span><br><span class="line"><span class="keyword">import</span> com.ubx.notificationtest.databinding.ActivityMainBinding</span><br><span class="line"><span class="keyword">import</span> kotlin.random.Random</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> mainBinding: ActivityMainBinding</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        mainBinding = ActivityMainBinding.inflate(layoutInflater)</span><br><span class="line">        setContentView(mainBinding.root)</span><br><span class="line">        <span class="comment">// 获取NotificationManager实例</span></span><br><span class="line">        <span class="keyword">val</span> manager = getSystemService(Context.NOTIFICATION_SERVICE) <span class="keyword">as</span> NotificationManager</span><br><span class="line">        <span class="comment">// 判断安卓版本是否为Android 8.0+</span></span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;</span><br><span class="line">            <span class="comment">// 安卓版本为 8.0+ 则使用NotificationChannel类构建一个通知渠道，</span></span><br><span class="line">            <span class="comment">// 并调用NotificationManager的createNotificationChannel()方法完成创建</span></span><br><span class="line">            <span class="keyword">val</span> channel =</span><br><span class="line">                NotificationChannel(<span class="string">&quot;normal&quot;</span>, <span class="string">&quot;Normal&quot;</span>, NotificationManager.IMPORTANCE_DEFAULT)</span><br><span class="line">            manager.createNotificationChannel(channel)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mainBinding.sendNotice.setOnClickListener &#123;</span><br><span class="line">            <span class="comment">// 检查是否已经有了通知权限</span></span><br><span class="line">            <span class="keyword">if</span> (!NotificationManagerCompat.from(<span class="keyword">this</span>).areNotificationsEnabled()) &#123;</span><br><span class="line">                <span class="comment">// 如果没有权限，向用户显示一个对话框，引导他们去设置中开启</span></span><br><span class="line">                AlertDialog.Builder(<span class="keyword">this</span>)</span><br><span class="line">                    .setTitle(<span class="string">&quot;需要通知权限&quot;</span>)</span><br><span class="line">                    .setMessage(<span class="string">&quot;此应用需要您允许通知权限才能正常工作。请点击“设置”按钮，然后在设置中开启通知权限。&quot;</span>)</span><br><span class="line">                    .setPositiveButton(<span class="string">&quot;设置&quot;</span>) &#123; _, _ -&gt;</span><br><span class="line">                        <span class="keyword">val</span> intent = Intent(Settings.ACTION_APPLICATION_DETAILS_SETTINGS)</span><br><span class="line">                        <span class="keyword">val</span> uri = Uri.fromParts(<span class="string">&quot;package&quot;</span>, packageName, <span class="literal">null</span>)</span><br><span class="line">                        intent.<span class="keyword">data</span> = uri</span><br><span class="line">                        startActivity(intent)</span><br><span class="line">                    &#125;</span><br><span class="line">                    .setNegativeButton(<span class="string">&quot;取消&quot;</span>) &#123; _, _ -&gt;</span><br><span class="line">                        <span class="comment">/*这个方法需要两个参数（一个 DialogInterface 对象和一个表示哪个按钮被点击的 int 值），</span></span><br><span class="line"><span class="comment">                        但是我们不关心这两个参数的具体值，所以我们用下划线 _ 来代替它们*/</span></span><br><span class="line">                        <span class="comment">// 用户点击取消，结束应用</span></span><br><span class="line">                        finish()</span><br><span class="line">                    &#125;</span><br><span class="line">                    .show()</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">val</span> intent = Intent(<span class="keyword">this</span>, NotificationActivity::<span class="keyword">class</span>.java)</span><br><span class="line">                <span class="comment">// 从 Android 12（API 级别 31）开始，创建 PendingIntent 时必须指定 FLAG_IMMUTABLE 或 FLAG_MUTABLE。</span></span><br><span class="line">                <span class="comment">// 这是因为 Android 12 对 PendingIntent 的行为进行了更改，以提高应用的安全性。</span></span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                * </span></span><br><span class="line"><span class="comment">                * FLAG_IMMUTABLE：这个标志表示 PendingIntent 是不可变的，也就是说，一旦创建，就不能更改。这是推荐的选项，因为它可以防止潜在的安全问题。</span></span><br><span class="line"><span class="comment">                * FLAG_MUTABLE：这个标志表示 PendingIntent 是可变的，也就是说，可以在创建后进行更改。只有在某些功能依赖于 PendingIntent 的可变性时，才应该使用这个选项，例如，需要与内联回复或气泡一起使用。</span></span><br><span class="line"><span class="comment">                * */</span></span><br><span class="line">                <span class="keyword">val</span> pi = PendingIntent.getActivity(<span class="keyword">this</span>, <span class="number">0</span>, intent, PendingIntent.FLAG_UPDATE_CURRENT or PendingIntent.FLAG_IMMUTABLE)</span><br><span class="line">                <span class="comment">// 已经有权限，可以进行下一步操作</span></span><br><span class="line">                <span class="comment">// AndroidX库中提供了一个NotificationCompat类，使用这个类的构造器创建</span></span><br><span class="line">                <span class="comment">// Notification对象，就可以保证我们的程序在所有Android系统版本上都能正常工作了</span></span><br><span class="line">                <span class="keyword">val</span> notification = NotificationCompat.Builder(<span class="keyword">this</span>, <span class="string">&quot;normal&quot;</span>)</span><br><span class="line">                    <span class="comment">// setContentTitle()方法用于指定通知的标题内容，下拉系统状态栏就可以看到这部分内容。</span></span><br><span class="line">                    .setContentTitle(<span class="string">&quot;this is content title&quot;</span>)</span><br><span class="line">                    <span class="comment">// setContentText()方法用于指定通知的正文内容，同样下拉系统状态栏就可以看到这部分内容。</span></span><br><span class="line">                    .setContentText(<span class="string">&quot;this is content text&quot;</span>.repeat(Random.nextInt(<span class="number">5</span>, <span class="number">10</span>)))</span><br><span class="line">                    <span class="comment">// setSmallIcon()方法</span></span><br><span class="line">                    <span class="comment">//用于设置通知的小图标，注意，只能使用纯alpha图层的图片进行设置，小图标会显示在系统状态栏上</span></span><br><span class="line">                    .setSmallIcon(R.drawable.small_icon)</span><br><span class="line">                    <span class="comment">// setLargeIcon()方法用于设置通知的大图标，当下拉系统状态栏时，就可以看到设置的大图标了。</span></span><br><span class="line">                    .setLargeIcon(</span><br><span class="line">                        BitmapFactory.decodeResource(</span><br><span class="line">                            resources,</span><br><span class="line">                            R.drawable.large_icon</span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                    .setContentIntent(pi)</span><br><span class="line">                    .build()</span><br><span class="line">                <span class="comment">// 调用NotificationManager的notify()方法就可以让通知显示出来了。notify()方法接收两个参数：</span></span><br><span class="line">                <span class="comment">// 第一个参数是id，要保证为每个通知指定的id都是不同的；第二个参数则是Notification对象，</span></span><br><span class="line">                <span class="comment">// 这里直接将我们刚刚创建好的Notification对象传入即可。</span></span><br><span class="line">                manager.notify(<span class="number">1</span>, notification)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> TAG = <span class="string">&quot;MainActivity&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果我们没有在代码中对该通知进行取消，它就会一直显示在系统的状态栏上。解决的方法有两种：一种是在<code>NotificationCompat.Builder</code>中再连缀一个<code>setAutoCancel()</code>方法，一种是显式地调用<code>NotificationManager</code>的<code>cancel()</code>方法将它取消。两种方法我们都学习一下。</p>
<p>第一种方法写法如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> notification = NotificationCompat.Builder(<span class="keyword">this</span>, <span class="string">&quot;normal&quot;</span>)</span><br><span class="line">	...</span><br><span class="line">	.setAutoCancel(<span class="literal">true</span>)</span><br><span class="line">	.build()</span><br></pre></td></tr></table></figure>

<p><code>setAutoCancel()</code>方法传入true，就表示当点击这个通知的时候，通知会自动取消。</p>
<p>第二种方法写法如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ubx.notificationtest</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.NotificationManager</span><br><span class="line"><span class="keyword">import</span> android.content.Context</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NotificationActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_notification)</span><br><span class="line">        <span class="keyword">val</span> manager = getSystemService(Context.NOTIFICATION_SERVICE) <span class="keyword">as</span> NotificationManager</span><br><span class="line">        manager.cancel(<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里我们在<code>cancel()</code>方法中传入了1，当时我们给这条通知设置的id就是1。因此，如果你想取消哪条通知，在<code>cancel()</code>方法中传入该通知的id就行了。</p>
<h3 id="1-3-通知的进阶技巧"><a href="#1-3-通知的进阶技巧" class="headerlink" title="1.3 通知的进阶技巧"></a>1.3 通知的进阶技巧</h3><p>当我们想在通知中显示较长的富文本时会发现，Android会将通知中的长文本折叠起来。那么有没有什么办法把富文本全部显示出来呢？实际上，<code>NotificationCompat.Builder</code>中提供了非常丰富的API，以便我们创建出更加多样的通知效果。先来看看<code>setStyle()</code>方法，这个方法允许我们构建出富文本的通知内容。也就是说，通知中不光可以有文字和图标，还可以包含更多的东西。<code>setStyle()</code>方法接收一个<code>NotificationCompat.Style</code>参数，这个参数就是用来构建具体的富文本信息的，如长文字、图片等。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> notification = NotificationCompat.Builder(<span class="keyword">this</span>, <span class="string">&quot;normal&quot;</span>)</span><br><span class="line">	...</span><br><span class="line">	.setStyle(NotificationCompat.BigTextStyle().bigText(<span class="string">&quot;Learn how to build notifications, send and sync data, and use voice actions. Get the official Android IDE and developer tools to build apps for Android.&quot;</span>))</span><br><span class="line">	.build()</span><br></pre></td></tr></table></figure>

<p>这里使用了<code>setStyle()</code>方法替代<code>setContentText()</code>方法。在<code>setStyle()</code>方法中，我们创建了一个<code>NotificationCompat.BigTextStyle</code>对象，这个对象就是用于封装长文字信息的，只要调用它的<code>bigText()</code>方法并将文字内容传入就可以了。</p>
<p>除了显示长文字之外，通知里还可以显示一张大图片，具体用法是基本相似的：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> notification = NotificationCompat.Builder(<span class="keyword">this</span>, <span class="string">&quot;normal&quot;</span>)</span><br><span class="line">	...</span><br><span class="line">	.setStyle(NotificationCompat.BigPictureStyle().bigPicture(BitmapFactory.decodeResource(resources, R.drawable.big_image)))</span><br><span class="line">	.build()</span><br></pre></td></tr></table></figure>

<p>可以看到，这里仍然是调用的<code>setStyle()</code>方法，这次我们在参数中创建了一个<code>NotificationCompat.BigPictureStyle</code>对象，这个对象就是用于设置大图片的，然后调用它的<code>bigPicture()</code>方法并将图片传入。这里使用事先准备好的一张图片，通过<code>BitmapFactory</code>的<code>decodeResource()</code>方法将图片解析成<code>Bitmap</code>对象，再传入<code>bigPicture()</code>方法中就可以了。</p>
<p>接下来来学习一下不同重要等级的通知渠道对通知的行为具体有什么影响。其实简单来讲，就是通知渠道的重要等级越高，发出的通知就越容易获得用户的注意。比如高重要等级的通知渠道发出的通知可以弹出横幅、发出声音，而低重要等级的通知渠道发出的通知不仅可能会在某些情况下被隐藏，而且可能会被改变显示的顺序，将其排在更重要的通知之后。但需要注意的是，开发者只能在创建通知渠道的时候为它指定初始的重要等级，如果用户不认可这个重要等级的话，可以随时进行修改，开发者对此无权再进行调整和变更，因为通知渠道一旦创建就不能再通过代码修改了。</p>
<p>虽然无法更改之前创建的通知渠道，但是我们可以创建一个新的通知渠道，如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;</span><br><span class="line">            ...</span><br><span class="line">            <span class="keyword">val</span> channel2 = NotificationChannel(<span class="string">&quot;important&quot;</span>, <span class="string">&quot;Important&quot;</span>, NotificationManager.IMPORTANCE_HIGH)</span><br><span class="line">            manager.createNotificationChannel(channel2)</span><br><span class="line">        &#125;</span><br><span class="line">        sendNotice.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">val</span> intent = Intent(<span class="keyword">this</span>, NotificationActivity::<span class="keyword">class</span>.java)</span><br><span class="line">            <span class="keyword">val</span> pi = PendingIntent.getActivity(<span class="keyword">this</span>, <span class="number">0</span>, intent, <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">val</span> notification = NotificationCompat.Builder(<span class="keyword">this</span>, <span class="string">&quot;important&quot;</span>)</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二、调用摄像头和相册"><a href="#二、调用摄像头和相册" class="headerlink" title="二、调用摄像头和相册"></a>二、调用摄像头和相册</h2><p>我们平时在使用QQ或微信的时候经常要和别人分享图片，这些图片可以是用手机摄像头拍的，也可以是从相册中选取的。这样的功能实在是太常见了，几乎是应用程序必备的功能，那么本节我们就学习一下调用摄像头和相册方面的知识。</p>
<h3 id="2-1-调用摄像头拍照"><a href="#2-1-调用摄像头拍照" class="headerlink" title="2.1 调用摄像头拍照"></a>2.1 调用摄像头拍照</h3><p>首先在布局文件中添加两个控件：一个Button和一个ImageView。Button是用于打开摄像头进行拍照的，而ImageView则是用于将拍到的图片显示出来。</p>
<p>开始编写调用摄像头的具体逻辑，修改MainActivity中的代码，如下所示：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> work.icu007.cameraalbumtest</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity</span><br><span class="line"><span class="keyword">import</span> android.content.Intent</span><br><span class="line"><span class="keyword">import</span> android.graphics.Bitmap</span><br><span class="line"><span class="keyword">import</span> android.graphics.BitmapFactory</span><br><span class="line"><span class="keyword">import</span> android.graphics.BitmapShader</span><br><span class="line"><span class="keyword">import</span> android.graphics.Canvas</span><br><span class="line"><span class="keyword">import</span> android.graphics.Matrix</span><br><span class="line"><span class="keyword">import</span> android.graphics.Paint</span><br><span class="line"><span class="keyword">import</span> android.graphics.Shader</span><br><span class="line"><span class="keyword">import</span> android.media.ExifInterface</span><br><span class="line"><span class="keyword">import</span> android.net.Uri</span><br><span class="line"><span class="keyword">import</span> android.os.Build</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle</span><br><span class="line"><span class="keyword">import</span> android.provider.MediaStore</span><br><span class="line"><span class="keyword">import</span> android.util.Log</span><br><span class="line"><span class="keyword">import</span> androidx.activity.result.ActivityResultLauncher</span><br><span class="line"><span class="keyword">import</span> androidx.activity.result.contract.ActivityResultContracts</span><br><span class="line"><span class="keyword">import</span> androidx.core.content.FileProvider</span><br><span class="line"><span class="keyword">import</span> com.ubx.cameraalbumtest.databinding.ActivityMainBinding</span><br><span class="line"><span class="keyword">import</span> java.io.File</span><br><span class="line"><span class="keyword">import</span> kotlin.properties.Delegates</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> imageUri: Uri</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> outputImage: File</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> mainBinding: ActivityMainBinding</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> takePhoto: ActivityResultLauncher&lt;Intent&gt;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        mainBinding = ActivityMainBinding.inflate(layoutInflater)</span><br><span class="line">        setContentView(mainBinding.root)</span><br><span class="line"></span><br><span class="line">        takePhoto = registerForActivityResult(ActivityResultContracts.StartActivityForResult()) &#123; result -&gt;</span><br><span class="line">            <span class="keyword">if</span> (result.resultCode == Activity.RESULT_OK) &#123;</span><br><span class="line">                <span class="comment">// 在这里处理图片捕获成功的情况</span></span><br><span class="line">                <span class="keyword">val</span> bitmap = BitmapFactory.decodeStream(contentResolver.openInputStream(imageUri))</span><br><span class="line">                <span class="keyword">if</span> (bitmap != <span class="literal">null</span>)&#123;</span><br><span class="line">                    mainBinding.imageView.setImageBitmap(rotateIfRequired(bitmap))</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Log.d(TAG, <span class="string">&quot;onCreate: take Photo error&quot;</span>)</span><br><span class="line">                <span class="comment">// 在这里处理图片捕获失败的情况</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        mainBinding.takePhotoBtn.setOnClickListener &#123;</span><br><span class="line">            outputImage = File(externalCacheDir, <span class="string">&quot;output_image.jpg&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> (outputImage.exists()) &#123;</span><br><span class="line">                outputImage.delete()</span><br><span class="line">            &#125;</span><br><span class="line">            outputImage.createNewFile()</span><br><span class="line">            imageUri = <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;</span><br><span class="line">                FileProvider.getUriForFile(<span class="keyword">this</span>, <span class="string">&quot;work.icu007.cameraalbumtest.fileprovider&quot;</span>, outputImage)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Uri.fromFile(outputImage)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 已经被弃用</span></span><br><span class="line">            <span class="comment">/*val intent = Intent(&quot;android.media.action.IMAGE_CAPTURE&quot;)</span></span><br><span class="line"><span class="comment">            intent.putExtra(MediaStore.EXTRA_OUTPUT, imageUri)</span></span><br><span class="line"><span class="comment">            startActivityForResult(intent, takePhoto)*/</span></span><br><span class="line">            <span class="keyword">val</span> intent = Intent(<span class="string">&quot;android.media.action.IMAGE_CAPTURE&quot;</span>)</span><br><span class="line">            intent.putExtra(MediaStore.EXTRA_OUTPUT, imageUri)</span><br><span class="line">            takePhoto.launch(intent)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">rotateIfRequired</span><span class="params">(bitmap: <span class="type">Bitmap</span>)</span></span>: Bitmap &#123;</span><br><span class="line">        <span class="keyword">val</span> exif = ExifInterface(outputImage.path)</span><br><span class="line">        <span class="keyword">val</span> orientation = exif.getAttributeInt(ExifInterface.TAG_ORIENTATION,</span><br><span class="line">            ExifInterface.ORIENTATION_NORMAL)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">when</span> (orientation) &#123;</span><br><span class="line">            ExifInterface.ORIENTATION_ROTATE_90 -&gt; rotateBitmap(bitmap, <span class="number">90</span>)</span><br><span class="line">            ExifInterface.ORIENTATION_ROTATE_180 -&gt; rotateBitmap(bitmap, <span class="number">180</span>)</span><br><span class="line">            ExifInterface.ORIENTATION_ROTATE_270 -&gt; rotateBitmap(bitmap, <span class="number">270</span>)</span><br><span class="line">            <span class="keyword">else</span> -&gt; bitmap</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">rotateBitmap</span><span class="params">(bitmap: <span class="type">Bitmap</span>, degree: <span class="type">Int</span>)</span></span>: Bitmap &#123;</span><br><span class="line">        <span class="keyword">val</span> matrix = Matrix()</span><br><span class="line">        matrix.postRotate(degree.toFloat())</span><br><span class="line">        <span class="keyword">val</span> rotatedBitmap = Bitmap.createBitmap(bitmap, <span class="number">0</span>, <span class="number">0</span>, bitmap.width, bitmap.height,</span><br><span class="line">            matrix, <span class="literal">true</span>)</span><br><span class="line">        bitmap.recycle() <span class="comment">// 将不再需要的Bitmap对象回收</span></span><br><span class="line">        <span class="keyword">return</span> rotatedBitmap</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> TAG = <span class="string">&quot;MainActivity&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>MainActivity</code>中要做的第一件事自然是给Button注册点击事件，然后就是实例化 <code>takePhoto</code> 对象，并且注册返回结果的处理函数。紧接着在点击事件里开始处理调用摄像头的逻辑:</p>
<p>首先这里创建了一个<code>File</code>对象，用于存放摄像头拍下的图片，这里我们把图片命名为<code>output_image.jpg</code>，并存放在手机SD卡的应用关联缓存目录下。什么叫作应用关联缓存目录呢？就是指SD卡中专门用于存放当前应用缓存数据的位置，调用<code>getExternalCacheDir()</code>方法可以得到这个目录，具体的路径是<code>/sdcard/Android/data/&lt;package name&gt;/cache</code>。那么为什么要使用应用关联缓存目录来存放图片呢？因为从<code>Android 6.0</code>系统开始，读写SD卡被列为了危险权限，如果将图片存放在SD卡的任何其他目录，都要进行运行时权限处理才行，而使用应用关联目录则可以跳过这一步。另外，从Android 10.0系统开始，公有的SD卡目录已经不再允许被应用程序直接访问了，而是要使用作用域存储才行。</p>
<p>接着会进行一个判断，如果运行设备的系统版本低于Android 7.0，就调用Uri的<code>fromFile()</code>方法将File对象转换成Uri对象，这个Uri对象标识着<code>output_image.jpg</code>这张图片的本地真实路径。否则，就调用<code>FileProvider</code>的<code>getUriForFile()</code>方法将File对象转换成一个封装过的Uri对象。<code>getUriForFile()</code>方法接收3个参数：第一个参数要求传入Context对象，第二个参数可以是任意唯一的字符串，第三个参数则是我们刚刚创建的File对象。之所以要进行这样一层转换，是因为从Android 7.0系统开始，直接使用本地真实路径的Uri被认为是不安全的，会抛出一个<code>FileUriExposedException</code>异常。而<code>FileProvider</code>则是一种特殊的<code>ContentProvider</code>，它使用了和<code>ContentProvider</code>类似的机制来对数据进行保护，可以选择性地将封装过的Uri共享给外部，从而提高了应用的安全性。</p>
<p>接下来构建了一个<code>Intent</code>对象，并将这个<code>Intent</code>的<code>action</code>指定为<code>android.media.action.IMAGE_CAPTURE</code>，再调用<code>Intent</code>的<code>putExtra()</code>方法指定图片的输出地址，这里填入刚刚得到的Uri对象，最后调用<code>ActivityResultLauncher</code>对象的<code>launch()</code>方法来启动相机应用进行捕获图片。</p>
<p>调用照相机程序去拍照有可能会在一些手机上发生照片旋转的情况。这是因为这些手机认为打开摄像头进行拍摄时手机就应该是横屏的，因此回到竖屏的情况下就会发生90度的旋转。为此，这里我们又加上了判断图片方向的代码，如果发现图片需要进行旋转，那么就先将图片旋转相应的角度，然后再显示到界面上。</p>
<p>刚才提到了<code>ContentProvider</code>，那么我们自然要在<code>AndroidManifest.xml</code>中对它进行注册才行，代码如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:allowBackup</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:dataExtractionRules</span>=<span class="string">&quot;@xml/data_extraction_rules&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fullBackupContent</span>=<span class="string">&quot;@xml/backup_rules&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:roundIcon</span>=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:theme</span>=<span class="string">&quot;@style/Theme.CameraAlbumTest&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:targetApi</span>=<span class="string">&quot;31&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">provider</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;androidx.core.content.FileProvider&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:authorities</span>=<span class="string">&quot;work.icu007.cameraalbumtest.fileprovider&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:exported</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:grantUriPermissions</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:name</span>=<span class="string">&quot;android.support.FILE_PROVIDER_PATHS&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:resource</span>=<span class="string">&quot;@xml/file_paths&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">provider</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;.MainActivity&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>android:name</code>属性的值是固定的，而<code>android:authorities</code>属性的值必须和刚才<code>FileProvider.getUriForFile()</code>方法中的第二个参数一致。另外，这里还在<code>&lt;provider&gt;</code>标签的内部使用<code>&lt;meta-data&gt;</code>指定Uri的共享路径，并引用了一个<code>@xml/file_paths</code>资源。当然，这个资源现在还是不存在的，下面我们就来创建它。</p>
<p>右击res目录→New→Directory，创建一个xml目录，接着右击xml目录→New→File，创建一个<code>file_paths.xml</code>文件。然后修改<code>file_paths.xml</code>文件中的内容，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">paths</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">external-path</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">&quot;my_images&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">paths</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>external-path</code>就是用来指定Uri共享路径的，<code>name</code>属性的值可以随便填，<code>path</code>属性的值表示共享的具体路径。这里使用一个单斜线表示将<strong>整个SD卡进行共享</strong>，当然你也可以仅共享存放output_image.jpg这张图片的路径。</p>
<h3 id="2-2-从相册选择图片"><a href="#2-2-从相册选择图片" class="headerlink" title="2.2 从相册选择图片"></a>2.2 从相册选择图片</h3><p>还是在 2.1 项目基础上修改，新增一个<code>button</code>用于从相册中选择图片。</p>
<p>修改<code>mainActivity</code>代码：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ubx.cameraalbumtest</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity</span><br><span class="line"><span class="keyword">import</span> android.content.Intent</span><br><span class="line"><span class="keyword">import</span> android.graphics.Bitmap</span><br><span class="line"><span class="keyword">import</span> android.graphics.BitmapFactory</span><br><span class="line"><span class="keyword">import</span> android.graphics.BitmapShader</span><br><span class="line"><span class="keyword">import</span> android.graphics.Canvas</span><br><span class="line"><span class="keyword">import</span> android.graphics.Matrix</span><br><span class="line"><span class="keyword">import</span> android.graphics.Paint</span><br><span class="line"><span class="keyword">import</span> android.graphics.Shader</span><br><span class="line"><span class="keyword">import</span> android.media.ExifInterface</span><br><span class="line"><span class="keyword">import</span> android.net.Uri</span><br><span class="line"><span class="keyword">import</span> android.os.Build</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle</span><br><span class="line"><span class="keyword">import</span> android.provider.MediaStore</span><br><span class="line"><span class="keyword">import</span> android.util.Log</span><br><span class="line"><span class="keyword">import</span> androidx.activity.result.ActivityResultLauncher</span><br><span class="line"><span class="keyword">import</span> androidx.activity.result.contract.ActivityResultContracts</span><br><span class="line"><span class="keyword">import</span> androidx.core.content.FileProvider</span><br><span class="line"><span class="keyword">import</span> com.ubx.cameraalbumtest.databinding.ActivityMainBinding</span><br><span class="line"><span class="keyword">import</span> java.io.File</span><br><span class="line"><span class="keyword">import</span> kotlin.properties.Delegates</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> imageUri: Uri</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> outputImage: File</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> mainBinding: ActivityMainBinding</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> takePhoto: ActivityResultLauncher&lt;Intent&gt;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> fromAlbum: ActivityResultLauncher&lt;Intent&gt;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        mainBinding = ActivityMainBinding.inflate(layoutInflater)</span><br><span class="line">        setContentView(mainBinding.root)</span><br><span class="line"></span><br><span class="line">        ...</span><br><span class="line">        fromAlbum = registerForActivityResult(ActivityResultContracts.StartActivityForResult()) &#123;result -&gt;</span><br><span class="line">            <span class="keyword">if</span> (result.resultCode == Activity.RESULT_OK &amp;&amp; result.<span class="keyword">data</span> != <span class="literal">null</span>)&#123;</span><br><span class="line">                result.<span class="keyword">data</span>!!.<span class="keyword">data</span>?.let &#123; uri -&gt;</span><br><span class="line">                    <span class="keyword">val</span> bitmap = BitmapFactory.decodeStream(contentResolver.openInputStream(uri))</span><br><span class="line">                    mainBinding.imageView.setImageBitmap(bitmap)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">        mainBinding.fromAlbumBtn.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">val</span> intent = Intent(Intent.ACTION_OPEN_DOCUMENT)</span><br><span class="line">            intent.addCategory(Intent.CATEGORY_OPENABLE)</span><br><span class="line">            intent.type = <span class="string">&quot;image/*&quot;</span></span><br><span class="line">            fromAlbum.launch(intent)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> TAG = <span class="string">&quot;MainActivity&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在“<code>From Album</code>”按钮的点击事件里，我们先构建了一个<code>Intent</code>对象，并将它的<code>action</code>指定为<code>Intent.ACTION_OPEN_DOCUMENT</code>，表示打开系统的文件选择器。接着给这个<code>Intent</code>对象设置一些条件过滤，只允许可打开的图片文件显示出来，然后调用<code>fromAlbum.launch(intent)</code>，打开文件选择器。</p>
<ol>
<li><code>registerForActivityResult(ActivityResultContracts.StartActivityForResult()) &#123;result -&gt;...&#125;</code>：在这段代码中，使用registerForActivityResult方法注册了一个回调函数。这个方法接收两个参数，一个是要启动的Activity的类型描述，另一个是回调函数。此处的ActivityResultContracts.StartActivityForResult()表示启动的Activity是为了返回数据。在回调函数中，参数<code>result</code>即代表启动Activity的结果。</li>
<li>在回调函数中，首先检查了<code>result.resultCode == Activity.RESULT_OK &amp;&amp; result.data != null</code>，这也是常见的模式，意味着返回的结果有效且有返回数据。在此条件满足的情况下，<code>result.data!!.data?.let &#123; uri -&gt;...&#125;</code> 这段代码解释了对返回的数据<code>result.data.data</code>即图片的URI的处理。使用<code>let</code>是Kotlin语言中的函数式编程风格，当<code>result.data!!.data</code>不为空时，执行其代码块，此处的uri即代表图片的URI。</li>
<li><code>val bitmap = BitmapFactory.decodeStream(contentResolver.openInputStream(uri))</code>这段代码使用BitmapFactory解码stream得到一个bitmap，而stream是使用contentResolver从图片的uri中获取到的。</li>
<li><code>mainBinding.imageView.setImageBitmap(bitmap)</code>将解码得到的bitmap设为imageView的图像显示。</li>
</ol>
<h2 id="三、播放多媒体文件"><a href="#三、播放多媒体文件" class="headerlink" title="三、播放多媒体文件"></a>三、播放多媒体文件</h2><p>手机上最常见的休闲方式毫无疑问就是听音乐和看电影了，随着移动设备的普及，越来越多的人可以随时享受优美的音乐，观看精彩的电影。Android在播放音频和视频方面做了相当不错的支持，它提供了一套较为完整的API，使得开发者可以很轻松地编写出一个简易的音频或视频播放器，下面我们就来具体地学习一下。</p>
<h3 id="3-1-播放音频"><a href="#3-1-播放音频" class="headerlink" title="3.1 播放音频"></a>3.1 播放音频</h3><p>在Android中播放音频文件一般是使用<code>MediaPlayer</code>类实现的，它对多种格式的音频文件提供了非常全面的控制方法，从而使播放音乐的工作变得十分简单。下表列出了<code>MediaPlayer</code>类中一些较为常用的控制方法。</p>
<table>
<thead>
<tr>
<th align="center">方法名</th>
<th align="center">功能描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">setDataSource()</td>
<td align="center">设置要播放的音频文件的位置</td>
</tr>
<tr>
<td align="center">prepare()</td>
<td align="center">在开始播放之前调用，以完成准备工作</td>
</tr>
<tr>
<td align="center">start()</td>
<td align="center">开始或继续播放音频</td>
</tr>
<tr>
<td align="center">pause()</td>
<td align="center">暂停播放音频</td>
</tr>
<tr>
<td align="center">reset()</td>
<td align="center">将MediaPlayer对象重置到刚刚创建的状态</td>
</tr>
<tr>
<td align="center">seekTo()</td>
<td align="center">从指定的位置开始播放音频</td>
</tr>
<tr>
<td align="center">stop()</td>
<td align="center">停止播放音频。调用后的MediaPlayer对象无法再播放音频</td>
</tr>
<tr>
<td align="center">release()</td>
<td align="center">释放与MediaPlayer对象相关的资源</td>
</tr>
<tr>
<td align="center">isPlaying()</td>
<td align="center">判断当前MediaPlayer是否正在播放音频</td>
</tr>
<tr>
<td align="center">getDuration()</td>
<td align="center">获取载入的音频文件的时长</td>
</tr>
</tbody></table>
<p>简单了解了上述方法后，我们再来梳理一下<code>MediaPlayer</code>的工作流程。首先需要创建一个<code>MediaPlayer</code>对象，然后调用<code>setDataSource()</code>方法设置音频文件的路径，再调用<code>prepare()</code>方法使<code>MediaPlayer</code>进入准备状态，接下来调用<code>start()</code>方法就可以开始播放音频，调用<code>pause()</code>方法就会暂停播放，调用<code>reset()</code>方法就会停止播放。下面就让我们通过一个具体的例子来学习一下，代码如下所示：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> work.icu007.playaudiotest</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.media.MediaPlayer</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity</span><br><span class="line"><span class="keyword">import</span> work.icu007.playaudiotest.databinding.ActivityMainBinding</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> mainBinding: ActivityMainBinding</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> mediaPlayer = MediaPlayer()</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        mainBinding = ActivityMainBinding.inflate(layoutInflater)</span><br><span class="line">        setContentView(mainBinding.root)</span><br><span class="line">        initMediaPlayer()</span><br><span class="line">        mainBinding.play.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">if</span> (!mediaPlayer.isPlaying) &#123;</span><br><span class="line">                mediaPlayer.start()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        mainBinding.pause.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">if</span> (mediaPlayer.isPlaying) &#123;</span><br><span class="line">                mediaPlayer.pause()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        mainBinding.stop.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">if</span> (mediaPlayer.isPlaying) &#123;</span><br><span class="line">                mediaPlayer.reset()</span><br><span class="line">                initMediaPlayer()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">initMediaPlayer</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> assetManager = assets</span><br><span class="line">        <span class="keyword">val</span> fd = assetManager.openFd(<span class="string">&quot;人生浪费指南 - 夏日入侵企画.mp3&quot;</span>)</span><br><span class="line">        mediaPlayer.setDataSource(fd.fileDescriptor, fd.startOffset, fd.length)</span><br><span class="line">        mediaPlayer.prepare()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroy</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy()</span><br><span class="line">        mediaPlayer.stop()</span><br><span class="line">        mediaPlayer.release()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在类初始化的时候，我们就先创建了一个<code>MediaPlayer</code>的实例，然后在<code>onCreate()</code>方法中调用<code>initMediaPlayer()</code>方法，为<code>MediaPlayer</code>对象进行初始化操作。在<code>initMediaPlayer()</code>方法中，首先通过<code>getAssets()</code>方法得到了一个<code>AssetManager</code>的实例，<code>AssetManager</code>可用于读取assets目录下的任何资源。接着我们调用了<code>openFd()</code>方法将音频文件句柄打开，后面又依次调用了<code>setDataSource()</code>方法和<code>prepare()</code>方法，为<code>MediaPlayer</code>做好了播放前的准备。</p>
<p>当点击“Play”按钮时会进行判断，如果当前<code>MediaPlayer</code>没有正在播放音频，则调用<code>start()</code>方法开始播放。当点击“Pause”按钮时会判断，如果当前<code>MediaPlayer</code>正在播放音频，则调用<code>pause()</code>方法暂停播放。当点击“Stop”按钮时会判断，如果当前<code>MediaPlayer</code>正在播放音频，则调用<code>reset()</code>方法将<code>MediaPlayer</code>重置为刚刚创建的状态，然后重新调用一遍<code>initMediaPlayer()</code>方法。最后在<code>onDestroy()</code>方法中，我们还需要分别调用<code>stop()</code>方法和<code>release()</code>方法，将与<br><code>MediaPlayer</code>相关的资源释放掉。</p>
<h3 id="3-2-播放视频"><a href="#3-2-播放视频" class="headerlink" title="3.2 播放视频"></a>3.2 播放视频</h3><p>播放视频文件其实并不比播放音频文件复杂，主要是使用<code>VideoView</code>类来实现的。这个类将视频的显示和控制集于一身，我们仅仅借助它就可以完成一个简易的视频播放器。<code>VideoView</code>的用法和<code>MediaPlayer</code>也比较类似，常用方法如下表所示。</p>
<table>
<thead>
<tr>
<th align="center">方法名</th>
<th align="center">功能描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">setVideoPath()</td>
<td align="center">设置要播放的视频文件的位置</td>
</tr>
<tr>
<td align="center">start()</td>
<td align="center">开始或继续播放视频</td>
</tr>
<tr>
<td align="center">pause()</td>
<td align="center">暂停播放视频</td>
</tr>
<tr>
<td align="center">resume()</td>
<td align="center">将视频从头开始播放</td>
</tr>
<tr>
<td align="center">seekTo()</td>
<td align="center">从指定的位置开始播放视频</td>
</tr>
<tr>
<td align="center">isPlaying()</td>
<td align="center">判断当前是否正在播放视频</td>
</tr>
<tr>
<td align="center">getDuration()</td>
<td align="center">获取载入的视频文件的时长</td>
</tr>
<tr>
<td align="center">suspend()</td>
<td align="center">释放ViedoView所占用的资源</td>
</tr>
</tbody></table>
<p>编辑布局文件如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/play&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Play&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_margin</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toStartOf</span>=<span class="string">&quot;@id/pause&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toTopOf</span>=<span class="string">&quot;@id/videoView&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/pause&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Pause&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_margin</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toEndOf</span>=<span class="string">&quot;@id/play&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toStartOf</span>=<span class="string">&quot;@id/reply&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toTopOf</span>=<span class="string">&quot;@id/videoView&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/reply&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Reply&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_margin</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toEndOf</span>=<span class="string">&quot;@id/pause&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toTopOf</span>=<span class="string">&quot;@id/videoView&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">VideoView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/videoView&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toBottomOf</span>=<span class="string">&quot;@id/pause&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>而后修改MainActivity中的代码，如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> work.icu007.playvideotest</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.net.Uri</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle</span><br><span class="line"><span class="keyword">import</span> android.util.Log</span><br><span class="line"><span class="keyword">import</span> android.widget.MediaController</span><br><span class="line"><span class="keyword">import</span> work.icu007.playvideotest.databinding.ActivityMainBinding</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> mainBinding: ActivityMainBinding</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        mainBinding = ActivityMainBinding.inflate(layoutInflater)</span><br><span class="line">        setContentView(mainBinding.root)</span><br><span class="line">        <span class="keyword">val</span> uri = Uri.parse(<span class="string">&quot;android.resource://<span class="variable">$packageName</span>/<span class="subst">$&#123;R.raw.video&#125;</span>&quot;</span>)</span><br><span class="line">        Log.d(TAG, <span class="string">&quot;onCreate: uri: <span class="variable">$uri</span>&quot;</span>)</span><br><span class="line">        mainBinding.videoView.setVideoURI(uri)</span><br><span class="line">        <span class="keyword">val</span> mediaController = MediaController(<span class="keyword">this</span>)</span><br><span class="line">        mainBinding.videoView.setMediaController(mediaController)</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        mainBinding.play.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">if</span> (!mainBinding.videoView.isPlaying)&#123;</span><br><span class="line">                mainBinding.videoView.start()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        mainBinding.pause.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">if</span> (mainBinding.videoView.isPlaying)&#123;</span><br><span class="line">                mainBinding.videoView.pause()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        mainBinding.reply.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">if</span> (mainBinding.videoView.isPlaying)&#123;</span><br><span class="line">                mainBinding.videoView.resume()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroy</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy()</span><br><span class="line">        mainBinding.videoView.<span class="keyword">suspend</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> TAG = <span class="keyword">this</span>.javaClass.simpleName</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先在<code>onCreate()</code>方法中调用了<code>Uri.parse()</code>方法，将raw目录下的video.mp4文件解析成了一个Uri对象，这里使用的写法是Android要求的固定写法。然后调用<code>VideoView</code>的<code>setVideoURI()</code>方法将刚才解析出来的Uri对象传入，这样<code>VideoView</code>就初始化完成了。</p>
<p>当点击“Play”按钮时会判断，如果当前没有正在播放视频，则调用<code>start()</code>方法开始播放。当点击“Pause”按钮时会判断，如果当前视频正在播放，则调用<code>pause()</code>方法暂停播放。当点击“Replay”按钮时会判断，如果当前视频正在播放，则调用<code>resume()</code>方法从头播放视频。最后在<code>onDestroy()</code>方法中，我们还需要调用一下<code>suspend()</code>方法，将VideoView所占用的资源释放掉。还添加了一个<code>MediaController</code>。<code>MediaController</code>可以提供一套控制面板，用户可以用它来播放、暂停和快进视频。</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://icu007.work/wp-content/uploads/2022/03/head-1.jpeg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://icu007.work/wp-content/uploads/2022/03/head-1.jpeg" title="头像" alt="头像"></a><div class="post-copyright__author_name">Rookie_l</div><div class="post-copyright__author_desc">偷得浮生半日闲</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://icu007work.github.io/archives/3c95749.html">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://icu007work.github.io/archives/3c95749.html')">Kotlin安卓开发-运用手机多媒体</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://icu007work.github.io/archives/3c95749.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=Kotlin安卓开发-运用手机多媒体&amp;url=https://icu007work.github.io/archives/3c95749.html&amp;pic=https://pic2.ziyuan.wang/user/xiheya/2024/05/Media_539aad6787976.jpg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://icu007work.github.io" target="_blank">米奇妙妙屋</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Kotlin/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Kotlin<span class="tagsPageCount">13</span></a><a class="post-meta__box__tags" href="/tags/%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>编程入门<span class="tagsPageCount">13</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://pic2.ziyuan.wang/user/xiheya/2024/05/Kotlin-Advance_535ea90c69f3c.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/archives/149564e1.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic2.ziyuan.wang/user/xiheya/2024/05/ContentProvider_ade10dd50ff3c.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Kotlin安卓开发-ContentProvider</div></div></a></div><div class="next-post pull-right"><a href="/archives/4928ca7e.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic2.ziyuan.wang/user/xiheya/2024/05/Service_595ef761c9141.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Kotlin安卓开发-Service</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/archives/f2287651.html" title="Kotlin安卓开发-Broadcast"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic2.ziyuan.wang/user/xiheya/2024/05/Android-Broadcast_e002cd5cd46cc.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-11-28</div><div class="title">Kotlin安卓开发-Broadcast</div></div></a></div><div><a href="/archives/add4ecd9.html" title="Kotlin入门"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic.ziyuan.wang/2023/09/11/guest_566671d879c50.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-09-11</div><div class="title">Kotlin入门</div></div></a></div><div><a href="/archives/149564e1.html" title="Kotlin安卓开发-ContentProvider"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic2.ziyuan.wang/user/xiheya/2024/05/ContentProvider_ade10dd50ff3c.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-12-09</div><div class="title">Kotlin安卓开发-ContentProvider</div></div></a></div><div><a href="/archives/4fa27f9d.html" title="Kotlin 进阶"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic2.ziyuan.wang/user/xiheya/2024/05/Kotlin-Advance_535ea90c69f3c.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-05-11</div><div class="title">Kotlin 进阶</div></div></a></div><div><a href="/archives/14654f7f.html" title="Kotlin安卓开发-Fragment"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic2.ziyuan.wang/user/xiheya/2024/05/Android-Fragment_459fb5ae97b91.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-11-15</div><div class="title">Kotlin安卓开发-Fragment</div></div></a></div><div><a href="/archives/f8eec5a0.html" title="Kotlin安卓开发-Jetpack"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic2.ziyuan.wang/user/xiheya/2024/05/Jetpack_cb169f472cca5.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-01-24</div><div class="title">Kotlin安卓开发-Jetpack</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://icu007.work/wp-content/uploads/2022/03/head-1.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">本站有关于<b style="color:#fff">科技、生活</b>相关的文章和随笔，还有<b style="color:#fff">编程基础知识</b>和<b style="color:#fff">实用工具</b>分享。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">希望你可以在本站中收获对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Rookie_l</h1><div class="author-info__desc">偷得浮生半日闲</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/hiheya" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/55406380" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://pic.ziyuan.wang/2023/08/22/30087e712d9fd.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://pic.ziyuan.wang/2023/08/22/e91ab86cccd2c.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%BD%BF%E7%94%A8%E9%80%9A%E7%9F%A5"><span class="toc-text">一、使用通知</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%88%9B%E5%BB%BA%E9%80%9A%E7%9F%A5%E6%B8%A0%E9%81%93"><span class="toc-text">1.1 创建通知渠道</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E9%80%9A%E7%9F%A5%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-text">1.2 通知的基本用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E9%80%9A%E7%9F%A5%E7%9A%84%E8%BF%9B%E9%98%B6%E6%8A%80%E5%B7%A7"><span class="toc-text">1.3 通知的进阶技巧</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E8%B0%83%E7%94%A8%E6%91%84%E5%83%8F%E5%A4%B4%E5%92%8C%E7%9B%B8%E5%86%8C"><span class="toc-text">二、调用摄像头和相册</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E8%B0%83%E7%94%A8%E6%91%84%E5%83%8F%E5%A4%B4%E6%8B%8D%E7%85%A7"><span class="toc-text">2.1 调用摄像头拍照</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E4%BB%8E%E7%9B%B8%E5%86%8C%E9%80%89%E6%8B%A9%E5%9B%BE%E7%89%87"><span class="toc-text">2.2 从相册选择图片</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%92%AD%E6%94%BE%E5%A4%9A%E5%AA%92%E4%BD%93%E6%96%87%E4%BB%B6"><span class="toc-text">三、播放多媒体文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E6%92%AD%E6%94%BE%E9%9F%B3%E9%A2%91"><span class="toc-text">3.1 播放音频</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E6%92%AD%E6%94%BE%E8%A7%86%E9%A2%91"><span class="toc-text">3.2 播放视频</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/archives/4fa27f9d.html" title="Kotlin 进阶"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic2.ziyuan.wang/user/xiheya/2024/05/Kotlin-Advance_535ea90c69f3c.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kotlin 进阶"/></a><div class="content"><a class="title" href="/archives/4fa27f9d.html" title="Kotlin 进阶">Kotlin 进阶</a><time datetime="2024-05-11T07:40:52.000Z" title="发表于 2024-05-11 15:40:52">2024-05-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/4a483fcb.html" title="Kotlin安卓开发-使用网络技术"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic2.ziyuan.wang/user/xiheya/2024/05/Network_0d14f49c4bca7.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kotlin安卓开发-使用网络技术"/></a><div class="content"><a class="title" href="/archives/4a483fcb.html" title="Kotlin安卓开发-使用网络技术">Kotlin安卓开发-使用网络技术</a><time datetime="2024-03-13T07:37:24.000Z" title="发表于 2024-03-13 15:37:24">2024-03-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/a3762f06.html" title="Kotlin安卓开发-Material"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic2.ziyuan.wang/user/xiheya/2024/05/Material_c668a539b4551.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kotlin安卓开发-Material"/></a><div class="content"><a class="title" href="/archives/a3762f06.html" title="Kotlin安卓开发-Material">Kotlin安卓开发-Material</a><time datetime="2024-02-27T07:34:17.000Z" title="发表于 2024-02-27 15:34:17">2024-02-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/6c099795.html" title="Kotlin安卓开发-高级技巧"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic2.ziyuan.wang/user/xiheya/2024/05/Advance_7270c77bc7e69.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kotlin安卓开发-高级技巧"/></a><div class="content"><a class="title" href="/archives/6c099795.html" title="Kotlin安卓开发-高级技巧">Kotlin安卓开发-高级技巧</a><time datetime="2024-02-04T07:31:01.000Z" title="发表于 2024-02-04 15:31:01">2024-02-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/f8eec5a0.html" title="Kotlin安卓开发-Jetpack"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic2.ziyuan.wang/user/xiheya/2024/05/Jetpack_cb169f472cca5.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kotlin安卓开发-Jetpack"/></a><div class="content"><a class="title" href="/archives/f8eec5a0.html" title="Kotlin安卓开发-Jetpack">Kotlin安卓开发-Jetpack</a><time datetime="2024-01-24T07:28:13.000Z" title="发表于 2024-01-24 15:28:13">2024-01-24</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:rookie_l@icu007.work" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://weibo.com/u/5400016811" title="微博"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://www.facebook.com/profile.php?id=61550101473898&amp;mibextid=2JQ9oc" title="facebook"><i class="anzhiyufont anzhiyu-icon-facebook1"></i></a><a class="deal_link" href="/atom.xml" title="RSS"><i class="anzhiyufont anzhiyu-icon-rss"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0, 500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://icu007.work/wp-content/uploads/2022/03/head-1.jpeg" size="50px"/><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/hiheya" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://space.bilibili.com/55406380" title="Bilibili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://v.douyin.com/iJm1hSu7/" title="抖音"><i class="anzhiyufont anzhiyu-icon-tiktok"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://www.upyun.com/?utm_source=lianmeng&amp;utm_medium=referral/" title="本网站由 又拍云 提供CDN加速/云存储服务"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-upyun"></use></svg></a></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="51la统计" target="_blank" rel="noopener" href="https://v6.51.la/">51la统计</a><a class="footer-item" title="十年之约" target="_blank" rel="noopener" href="https://www.foreverblog.cn/">十年之约</a><a class="footer-item" title="开往" target="_blank" rel="noopener" href="https://github.com/travellings-link/travellings">开往</a><a class="footer-item" title="本网站由 又拍云 提供CDN加速/云存储服务" target="_blank" rel="noopener" href="https://www.upyun.com/?utm_source=lianmeng&amp;utm_medium=referral/">本网站由 又拍云 提供CDN加速/云存储服务</a></div></div><div class="footer-group"><div class="footer-title">关于</div><div class="footer-links"><a class="footer-item" title="关于作者" href="/about/">关于作者</a><a class="footer-item" title="文章归档" href="/archives/">文章归档</a><a class="footer-item" title="更新日志" href="/update/">更新日志</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="即刻短文" href="/essay/">即刻短文</a><a class="footer-item" title="友链文章" href="/fcircle/">友链文章</a><a class="footer-item" title="留言板" href="/comments/">留言板</a></div></div><div class="footer-group"><div class="footer-title">协议</div><div class="footer-links"><a class="footer-item" title="隐私协议" href="/privacy/">隐私协议</a><a class="footer-item" title="Cookies" href="/cookies/">Cookies</a><a class="footer-item" title="版权协议" href="/copyright/">版权协议</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"/></a><a class="github-badge" target="_blank" href="https://www.upyun.com/?utm_source=lianmeng&amp;utm_medium=referral/" style="margin-inline:5px" data-title="本站使用又拍云为静态资源提供CDN加速" title="本站使用又拍云为静态资源提供CDN加速"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/CDN-又拍云-blue.svg?logo=iCloud" alt="本站使用又拍云为静态资源提供CDN加速"/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="Rookie_l" target="_blank">Rookie_l</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = ["尊重所有声音&#44; 但成为自己."]
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.1.0/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://icu007.work" title="主站">主站</a><a class="footer-bar-link cc" href="/copyright" title="cc协议"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-by-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nc-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nd-line"></i></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">61</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">21</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">4</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://icu007.work/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.png" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://chat.icu007.work/" title="ChatGPT"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.png" alt="ChatGPT"/><span class="back-menu-item-text">ChatGPT</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://baidu.icu007.work/" title="帮你百度一下"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.png" alt="帮你百度一下"/><span class="back-menu-item-text">帮你百度一下</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 站务</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 空调</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友链</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?id=6842714056&amp;server=netease"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 番剧</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于我</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 碎碎念</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 传送门</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Android/" style="font-size: 0.88rem;">Android<sup>2</sup></a><a href="/tags/Dos/" style="font-size: 0.88rem;">Dos<sup>1</sup></a><a href="/tags/IDEA/" style="font-size: 0.88rem;">IDEA<sup>1</sup></a><a href="/tags/Java/" style="font-size: 0.88rem;">Java<sup>23</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/" style="font-size: 0.88rem;">Java基础语法<sup>5</sup></a><a href="/tags/Java%E5%BC%82%E5%B8%B8/" style="font-size: 0.88rem;">Java异常<sup>2</sup></a><a href="/tags/Java%E6%95%B0%E7%BB%84/" style="font-size: 0.88rem;">Java数组<sup>3</sup></a><a href="/tags/Java%E6%96%B9%E6%B3%95/" style="font-size: 0.88rem;">Java方法<sup>1</sup></a><a href="/tags/Java%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/" style="font-size: 0.88rem;">Java流程控制<sup>3</sup></a><a href="/tags/Java%E7%89%B9%E6%80%A7/" style="font-size: 0.88rem;">Java特性<sup>1</sup></a><a href="/tags/Java%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" style="font-size: 0.88rem;">Java面向对象<sup>4</sup></a><a href="/tags/Kotlin/" style="font-size: 0.88rem;">Kotlin<sup>13</sup></a><a href="/tags/Markdown/" style="font-size: 0.88rem;">Markdown<sup>1</sup></a><a href="/tags/WP/" style="font-size: 0.88rem;">WP<sup>1</sup></a><a href="/tags/git/" style="font-size: 0.88rem;">git<sup>2</sup></a><a href="/tags/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" style="font-size: 0.88rem;">排序算法<sup>1</sup></a><a href="/tags/%E7%A1%AC%E4%BB%B6/" style="font-size: 0.88rem;">硬件<sup>1</sup></a><a href="/tags/%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8/" style="font-size: 0.88rem;">编程入门<sup>13</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 0.88rem;">设计模式<sup>2</sup></a><a href="/tags/%E8%BD%AF%E4%BB%B6%E5%88%86%E4%BA%AB/" style="font-size: 0.88rem;">软件分享<sup>1</sup></a><a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 0.88rem;">随笔<sup>13</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="6842714056" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://music.163.com/#/playlist?id=6842714056&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'DSKC4Zc0A0aO83qSYyJIczkF-gzGzoHsz',
      appKey: 'X4vG5DxFgvkzTBQNF8IRA7gi',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, {"valine":"/js/myjs/Valine.min.js"}))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('/js/myjs/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script src="https://cdn.cbd.int/blueimp-md5@2.19.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=monsterid'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://DSKC4Zc0.api.lncldglobal.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": 'DSKC4Zc0A0aO83qSYyJIczkF-gzGzoHsz',
        "X-LC-Key": 'X4vG5DxFgvkzTBQNF8IRA7gi',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script async src="https://at.alicdn.com/t/c/font_4201142_cetcbzr9wn.js"></script><script type="text/javascript" src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>